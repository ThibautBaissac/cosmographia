<%= render("billing/subscriptions/header", title: t('billing.subscription.subscription_history')) %>

<div class="container">
  <% if @subscriptions.any? %>
    <div class="table-responsive border border-secondary-subttle p-4 bg-white rounded-4">
      <table class="table table-hover table-bordered align-middle text-center">
        <thead class="table-primary">
          <tr>
            <th scope="col"><%= t("activerecord.models.billing_plan", count: 1) %></th>
            <th scope="col"><%= t("activerecord.attributes.billing_subscription.created_at") %></th>
            <th scope="col"><%= t("billing.subscription.current_billing_cycle_start") %></th>
            <th scope="col"><%= t("billing.subscription.current_billing_cycle_end") %></th>
            <th scope="col"><%= t("activerecord.attributes.billing_subscription.end_date") %></th>
            <th scope="col"><%= t("activerecord.attributes.billing_subscription.status") %></th>
          </tr>
        </thead>
        <tbody>
          <% @subscriptions.each do |subscription| %>
            <tr>
              <td>
                <%= subscription.plan_version.plan.name %>
                <%= " (#{number_to_currency(subscription.plan_version.price_cents / 100.0, unit: subscription.plan_version.currency)})" %>
              </td>
              <td><%= l(subscription.created_at, format: :dmy) %></td>
              <td><%= l(subscription.current_billing_cycle_start, format: :dmy) %></td>
              <td><%= subscription.active? ? l(subscription.current_billing_cycle_end, format: :dmy) : "-" %></td>
              <td><%= l(subscription.end_date, format: :dmy) if subscription.end_date.present? %></td>
              <td>
                <span class="badge <%= subscription.active? ? 'bg-success' : 'bg-secondary' %>">
                  <%= subscription.status.capitalize %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="text-center mt-5">
      <% if current_user.current_subscription.present? %>
        <%= link_to(t('billing.subscription.my_current_subscription'), billing_subscription_path(locale, current_user.current_subscription), class: "btn btn-outline-primary btn-lg rounded-4 mx-2") %>
      <% end %>
      <%= link_to(t('billing.subscription.change_subscription'), new_billing_subscription_path(locale), class: "btn btn-secondary btn-lg rounded-4 mx-2") %>
    </div>
  <% else %>
    <div class="alert alert-warning text-center p-5">
      <p class="fs-4"><%= t('billing.subscription.no_subscription_history') %></p>
      <%= link_to(t('billing.subscription.subscribe_now'), new_billing_subscription_path(locale), class: "btn btn-primary btn-lg rounded-4 mt-4") %>
    </div>
  <% end %>
</div>
