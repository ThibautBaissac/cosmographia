<%= render("billing/subscriptions/header", title: t('billing.subscription.subscribe_to_plan')) %>

<div class="container">
  <% if policy(Billing::Subscription).new? %>
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <% @latest_plan_versions.each do |pv| %>
        <div class="col">
          <div class="card h-100 border rounded-4 <%= current_user.current_plan_version == pv ? "border-success shadow-lg" : "border-secondary shadow-sm" %> overflow-hidden">
            <% if current_user.current_plan_version == pv %>
              <div class="position-absolute top-0 start-0 m-3">
                <i class="fa-solid fa-circle-check fs-4 text-success"></i>
              </div>
            <% end %>
            <div class="card-body text-center d-flex flex-column justify-content-between">
              <div>
                <h5 class="card-title fw-bold"><%= pv.plan.name %></h5>
                <p class="card-text text-muted"><%= pv.plan.description %></p>
                <p class="card-text fs-4 fw-semibold">
                  <%= number_to_currency(pv.price_cents / 100.0, unit: pv.currency) %> <small class="text-muted">/ month</small>
                </p>
                <ul class="list-unstyled mb-4">
                  <li><i class="fa-solid fa-eye me-2 text-primary"></i>Limit: <%= pv.monthly_visualization_limit %> views</li>
                </ul>
              </div>
              <div>
                <%= form_with(url: billing_subscriptions_path, method: :post, local: true) do |form| %>
                  <%= hidden_field_tag(:plan_version_id, pv.id) %>
                  <%= submit_tag(t("common.subscribe"), class: "btn btn-primary w-100 mt-3 rounded-3", disabled: (current_user.current_plan_version == pv)) %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <%= render("shared/guest_alert") %>
  <% end %>
</div>
